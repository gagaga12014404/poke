<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>guide</title>

</head>

<body>
    <table id="all" class="table table-striped table-bordered dt-responsive nowrap" style="width: 100%;">
        <thead>
            <tr id="theadtr">
                <th rowspan="2" style="width: 25px;">編號</th>
                <th rowspan="2" style="width: 25px;">圖片</th>
                <th rowspan="2" style="width: 50px;">名稱</th>
                <th colspan="2" style="width: 110px;text-align: center;height: 10px;padding: 0;">屬性</th>
                <th colspan="7" style="padding: 0; width: 60px;">
                    <select id="selectAbility" style="width: 60px;">
                        <option value="5" selected>生命</option>
                        <option value="6">物攻</option>
                        <option value="7">物防</option>
                        <option value="8">特攻</option>
                        <option value="9">特防</option>
                        <option value="10">速度</option>
                        <option value="11">種族值</option>
                    </select>
                </th>
                <th rowspan="2">種族值</th>
                <th rowspan="2" class="thhp">招式列表</th>
                <th rowspan="2">加入比較</th>
            </tr>
            <tr>
                <!--colspan 是複數的下面那層  -->
                <th style="padding: 0;height: 10px;width: 45px;text-align: center;">1</th>
                <th style="padding: 0;height: 10px;width: 45px;text-align: center;">2</th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
            </tr>
        </thead>
        <tfoot>
            <tr style="height: 25px;">
                <th id="nu" style="padding: 0;">編號</th>
                <th id="nu" style="padding: 0;">圖片</th>
                <th id="na" style="padding: 0;width: 50px;">名稱</th>
                <th colspan="2" style="padding: 0;width: 45px;text-align: center;"></th>
                <!-- <th style="padding: 0;height: 10px;width: 45px;text-align: center;">2</th> -->
                <th colspan="7"></th>
                <th class="thhp"></th>
                <th class="thhp"></th>
                <th></th>
            </tr>
        </tfoot>
    </table>
</body>
<script>
    var table;
    //table 1的資料表
    var column = ["編號", "圖片", "名稱", "屬性", "生命", "物攻", "物防", "特攻", "特防", "速度"];
    var countatkerName = 1;
    var ajaxdata = {};
    var GetPic = function (data) {
        var r = "";
        r += `<div style="background-image: url('pic/MSP_Normal2.webp');background-size: 2240px 2240px;background-position: ${data['background-position']};background-repeat: no-repeat;width:56px;height:56px"></div>`;//width:22px;不給就是欄位的寬度
        return r;
    }
    var GetFiveTotal = function (data) {
        return data["race"];
    }
    var GetFiveChart = function (data) {
        var x = 150, y = 15;
        var hp = parseInt(data["hp"]);
        var atk = parseInt(data["atk"]);
        var def = parseInt(data["def"]);
        var satk = parseInt(data["satk"]);
        var sdef = parseInt(data["sdef"]);
        var speed = parseInt(data["speed"]);
        column2 = [hp, atk, def, satk, sdef, speed];// / 255 * x
        colorList = ["#ffcccc", "#ffe6cc", "#ffffcc", "#d6f5d6", "#b3ecff", "#51A8DD"]
        colorList2 = ["#ff9999", "#ffcc99", "#e6e600", "#99e699", "#7acde9", "#4086b1"]
        colorBorder = ["#ff8080", "#ffbf80", "#cccc00", "#85e085", "#77c5e0", "#3b769a  "]
        var r = `<table style="font-size:25px"><tr style="background-color:#ffcc7f;font-weight:700;"><th colspan="2" style="text-align:center;">種族值</th><th style="text-align:center;">Lv.50</th></tr>`;
        var indexofHp = column.indexOf("生命");
        for (var i = 0; i < column2.length; i++) {
            var low;
            var hight;
            if (i == 0) {
                low = parseInt(column2[i] + 10 + 50);
                hight = parseInt((column2[i] * 2 + 31 + 63) / 2 + 10 + 50);
            }
            else {
                low = parseInt((column2[i] + 5) * 0.9);
                hight = parseInt(((column2[i] * 2 + 31 + 63) / 2 + 5) * 1.1);
            }
            r += `<tr style="background-color:${colorList[i]}">
                    <td style="padding:0 0 0 4px;width:80px;vertical-align:middle;text-align:left;font-weight:500;">
                        ${column[i + indexofHp]}：&nbsp&nbsp${column2[i]}&nbsp
                    </td>
                    <td style="padding:4px;width:150px;">
                        <div style="width:${column2[i] / 255 * x}px;height:${y}px;background-color:${colorList2[i]};border:1px ${colorBorder[i]} solid;top:0px;"></div>
                    </td>
                    <td style="padding:0px;width:80px;vertical-align:middle;text-align:center;font-weight:500">
                        ${low}~${hight}
                    </td>
                </tr>`;
        }
        r += `<tr style="background-color:#d9b3ff">
                <td colspan="3" style="padding:0 0 0 6px;vertical-align:middle;font-weight:500;">總和：${data['race']}</td>
              </tr></table>`;
        return r;
    }
    var Get招式表 = function (data) {
        var r = `<table style="font-size:25px;text-align:center">
            <tr class="header">
              <th style="padding:0">等級</th>
              <th style="padding:0">招式</th>
              <th style="padding:0">分類</th>
              <th style="padding:0">傷害</th>
              <th style="padding:0">命中</th>
              <th style="padding:0">PP</th>
            </tr>`
        data['招式'].forEach(move => {
            r += `<tr>
                    <td style="padding:0">${move[0]}</td>
                    <td style="padding:0">${move[1]}</td>
                    <td style="padding:0">${move[2]}</td>
                    <td style="padding:0">${move[3]}</td>
                    <td style="padding:0">${move[4]}</td>
                    <td style="padding:0">${move[5]}</td>
                  </tr>`
        });

        return r + `</table>`;
    }
    var AddToTable = function (data) {
        // console.log(data["hp"]);
        // return `<button onclick="ClickAddToTable('${data["number"].replace('\n','')}')">加入</button>`;
        // return `<button onclick="ClickAddToTable('${data["number"].replace('\n','')}')">加入</button>`;
        return `<input type="button" value="加入" class="ClickAddToTable">`;
    }


    var columns = [
        { "data": "number", "type": "num", "width": "14%" },
        { "data": null, "width": "0%", render: GetPic },
        { "data": "cName", "width": "26%" },
        { "data": "attr1", "width": "20%" },
        { "data": "attr2", "width": "20%" },
        { "data": "hp", "width": "20%" },
        { "data": "atk", "width": "20%" },
        { "data": "def", "width": "20%" },
        { "data": "satk", "width": "20%" },
        { "data": "sdef", "width": "20%" },
        { "data": "speed", "width": "20%" },
        { "data": null, render: GetFiveTotal },
        { "data": null, render: GetFiveChart, className: 'none' },//className:'none'一定縮
        { "data": null, render: Get招式表, className: 'none' },
        { 'data': null, render: AddToTable, className: 'none' },
    ];
    //tfoot的搜尋功能
    $('#nu,#na').each(function () {
        var title = $(this).text();
        $(this).html('<input type="text" class="inputSearch" placeholder="' + title + '" />');
    });
    $(document).ready(function () {
        table = $('#all').DataTable({
            "language": {
                "lengthMenu": "_MENU_",
            },
            "dom": `<'row'<'col-4 col-sm-4 col-md-4'l><'col-8 col-sm-8 col-md-8'f>>
            <'row'<'col-sm-12'tr>>
            <'row'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7'p>>`,
            "autoWidth": false,
            "ajax": "data.json",
            //拿到ajax的結果
            // "drawCallback": function (settings) {
            //   // Here the response
            //   response = settings.json;

            // },
            "columns": columns,
            // "info":     false,
            "pagingType": "numbers",
            initComplete: function (settings, json) {
                json.data.forEach(function (item, index) {
                    ajaxdata[item.cName] = item;
                    $('#atkerName').append(new Option(item.cName, item.cName));
                    $('#deferName').append(new Option(item.cName, item.cName));
                });
                // Apply the search
                //指定欄位搜尋
                this.api()
                    .columns([0, 1])//用column指定
                    .every(function () {
                        var that = this
                        $('input', this.footer()).on('keyup change clear', function () {
                            if (that.search() !== this.value) {
                                that.search(this.value).draw();
                            }
                        });
                    });
                //指定欄位下拉選單
                var 屬性搜尋 = this.api();
                this.api()
                    .columns(3)
                    .every(function () {
                        var column = this;
                        var select = $('<select style=" height: 25px; " ><option value=""></option></select>')
                            .appendTo($(column.footer()).empty())
                            .on('change', function () {
                                var val = $.fn.dataTable.util.escapeRegex($(this).val());//這裡的this是option的值
                                屬性搜尋.search(val).draw();
                                // filterColumn23(val);
                                // (column.search(val,false, true)+column3.search(val,false, true)).draw();
                                // console.log(typeof(column.search(val,false, true)));
                                // column3.search("^" + val,true,false,true).draw();
                                // column3.search(val).draw();
                            });

                        column
                            .data()
                            .unique()
                            .sort()
                            .each(function (d, j) {
                                if (typeof (d) == 'string')
                                    select.append('<option value="' + d + '">' + d + '</option>');
                            });
                    });
            },
            "columnDefs": [
                { "width": "10%", targets: 0, responsivePriority: 1 },
                { "width": "20%", targets: 1, responsivePriority: 2 },
                { "width": "20%", targets: 2, responsivePriority: 3 },
                { "width": "20%", targets: 3, responsivePriority: 3 },
                { "width": "20%", targets: 4, responsivePriority: 3 },
            ],
        });
        //option的value要注意
        //先隱藏，透過select option切換
        var dom_selectAbility = document.getElementById("selectAbility");
        selectAbilityPreSelect = dom_selectAbility.options[0].value;
        for (var i = 1; i < dom_selectAbility.options.length; i++) {
            table.column(dom_selectAbility.options[i].value).visible(false);
        }
        $('#selectAbility').click(function (e) {
            //點選的時候預防點到下層
            e.stopPropagation();
        });
        $('#selectAbility').change(function (e) {
            var column = table.column(selectAbilityPreSelect);
            column.visible(!column.visible());
            var column2 = table.column($(this).val());
            column2.visible(!column2.visible());
            selectAbilityPreSelect = $(this).val();
        });
        $('#all tbody').on('click', '.ClickAddToTable', function () {
            table3.row.add(table.row(this).data()).draw(false);
        });
    });
</script>

</html>