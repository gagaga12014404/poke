<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<style>
    #movesTable td.dt-control {
        text-align: center;
        padding-top: 5px;
        background-position: left 5px center;
        height: 30px;
    }

    #movesTable tr.dt-hasChild td.dt-control {
        background-position: left 5px center;
    }

    #movesTable_wrapper {
        margin: 0 auto;
    }

    @media only screen and (min-width: 600px) {

        /* 600px以上的屏幕样式 */
        #movesTable_wrapper {
            width: 600px;
        }

    }
</style>

<body>
    <table id="movesTable" class="table-striped table-bordered" style="width: 98%;">
        <thead>
            <tr style="height: 40px;">
                <th style="font-size:14px">編號</th>
                <th style="font-size:14px">名稱</th>
                <th style="font-size:14px">屬性</th>
                <th style="font-size:14px">分類</th>
                <th style="font-size:14px">傷害</th>
                <th style="font-size:14px">命中</th>
                <th style="font-size:14px">PP</th>
            </tr>
        </thead>
        <tfoot>
            <tr>

                <th></th>
                <th><input type="text" id="搜尋招式名稱" placeholder="名稱" style="width: 100%;"></th>
                <th></th>
                <th></th>
                <th><input type="text" placeholder="傷害" style="width: 100%;"></th>
                <th><input type="text" placeholder="命中" style="width: 100%;"></th>
                <th><input type="text" placeholder="PP" style="width: 100%;"></th>
            </tr>
        </tfoot>
    </table>
</body>
<script>
    //tfoot的搜尋功能
    // $('#movesThName,#movesThDescription').each(function () {
    //     var title = $(this).text();
    //     $(this).html('<input type="text" class="inputSearch" placeholder="' + title + '" />');
    // });
    function 招式表format(data) {
        return '<p class="ft14">' + data['說明'] + `</p><a onclick="尋找含有此特性寶可夢('${data['招式中文']}')" style="color:blue;text-decoration:underline">含有此招式寶可夢</a>`;
    }
    var Get招式名稱 = function (data) {
        return `<span style="font-size:8px">${data["招式日文"]}</span><br><span>${data["招式中文"]}</span><br><span style="font-size:8px">${data["招式英文"]}</span>`;
    }
    jQuery.extend(jQuery.fn.dataTableExt.oSort, {
        "chinese-numeric-pre": function (a) {
            if (!a || typeof a !== 'string') return 0; // 添加检查以确保输入值不是 null 或 undefined
            var match = a.match(/[\d\-\.]+/);
            if (!match) return 0; // 添加检查以确保可以找到数字部分
            var x = parseFloat(match[0]);
            return isNaN(x) ? -Infinity : x;
        },

        "chinese-numeric-asc": function (a, b) {
            return ((a < b) ? -1 : ((a > b) ? 1 : 0));
        },

        "chinese-numeric-desc": function (a, b) {
            return ((a < b) ? 1 : ((a > b) ? -1 : 0));
        }
    });

    $(document).ready(function () {
        var movesDataTable = $('#movesTable').DataTable({
            "language": {
                "lengthMenu": "_MENU_",
            },
            "ajax": "招式表.json",
            "dom": `<'row'<'col-4 col-sm-4 col-md-4'l><'col-8 col-sm-8 col-md-8'f>>
            <'row'<'col-sm-12'tr>>
            <'row'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7'p>>`,
            "autoWidth": false,
            initComplete: function (settings, json) {
                // Apply the search
                //指定欄位搜尋
                this.api()
                    .columns([1])//用column指定
                    .every(function () {
                        var that = this;
                        $('input', this.footer()).on('keyup', function () {
                            if (that.search() !== this.value) {
                                that.search(this.value).draw();
                            }
                        });
                    });
                this.api()
                    .columns([2, 3])
                    .every(function () {
                        var column = this;
                        var select = $('<select style=" height: 25px; " ><option value=""></option></select>')
                            .appendTo($(column.footer()).empty())
                            .on('change', function () {
                                if (column.search() !== this.value) {
                                    column.search(this.value).draw();
                                }
                            });
                        column
                            .data()
                            .unique()
                            .sort()
                            .each(function (d, j) {
                                if (typeof (d) == 'string')
                                    select.append('<option value="' + d + '">' + d + '</option>');
                            });
                    });

            },
            "columns": [
                /*{
                    "data": null,"width":"20%", orderable: false, class: 'dt-control',defaultContent: ''
                },*/

                { 'data': '編號', class: 'dt-control', "width": "50px" },
                { "data": null, "width": "100px", "class": "txtcenter", render: Get招式名稱 },
                { 'data': '屬性', "class": "txtcenter" },
                { 'data': '分類', "class": "txtcenter" },
                { 'data': '威力', "class": "txtcenter", "type": "chinese-numeric" },
                { 'data': '命中', "class": "txtcenter", "type": "chinese-numeric" },
                { 'data': 'PP', "class": "txtcenter", "type": "num" },
                { 'data': '說明', "class": "txtcenter", "visible": false },
            ],
            "pagingType": "numbers",
            "columnDefs": [
                {
                    target: [2], createdCell: function (td, cellData, rowData, row, col) {
                        let attr18 = ['一般', '格鬥', '飛行', '毒', '地面', '岩石', '蟲', '幽靈', '鋼', '火', '水', '草', '電', '超能力', '冰', '龍', '惡', '妖精'];
                        let attr18backgroundcolor = ['LightGray', 'orange', 'LightSkyBlue', 'MediumOrchid', 'SaddleBrown', 'Tan', 'PaleGreen', 'DarkSlateBlue', 'LightSlateGray', 'Tomato', 'RoyalBlue', 'YellowGreen', 'Yellow', 'MediumVioletRed', 'Aqua', 'MediumSlateBlue', 'Brown', 'Violet'];
                        let attr18color = ['DarkSlateGray', 'DarkSlateGray', 'DarkSlateGray', 'white', 'white', 'DarkSlateGray', 'DarkSlateGray', 'white', 'white', 'white', 'white', 'DarkSlateGray', 'DarkSlateGray', 'white', 'DarkSlateGray', 'white', 'white', 'white'];
                        for (var i = 0; i < attr18.length; i++) {
                            if (cellData == attr18[i]) {
                                $(td).css('background-color', attr18backgroundcolor[i]);
                                $(td).css('color', attr18color[i]);
                            }
                        }
                    }
                },
                {
                    target: [3], createdCell: function (td, cellData, rowData, row, col) {
                        let attr18 = ['特殊', '物理', '變化'];
                        let attr18backgroundcolor = ['#4d94ff', '#ff8080', '#f2f2f2'];
                        for (var i = 0; i < attr18.length; i++) {
                            if (cellData == attr18[i]) {
                                $(td).css('background-color', attr18backgroundcolor[i]);
                            }
                        }
                    }
                },

            ],

        });
        movesDataTable.on('click', 'td.dt-control', function (e) {
            let tr = e.target.closest('tr');
            let row = movesDataTable.row(tr);

            if (row.child.isShown()) {
                // This row is already open - close it
                row.child.hide();
            }
            else {
                // Open this row
                row.child(招式表format(row.data())).show();
            }
        });
    });
</script>

</html>