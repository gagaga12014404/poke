<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<style>
  .Nature button {
    background-color: inherit;
    color: rgb(182, 182, 182);
    /* float: left; */
    border: none;
    outline: none;
    cursor: pointer;
    /* padding: 8px 15px; */
    transition: 0.3s;
  }

  .Nature button.active {
    background-color: rgb(70, 70, 70);
  }

  ._btn- {
    width: 20px;
    height: 20px;
    padding: 0;
    line-height: 0;
  }

  ._btn {
    width: 20px;
    height: 20px;
    padding: 0;
    line-height: 0;
  }

  .inputnumber {
    width: 30px;
  }

  th {
    font-size: 0.7em;
  }

  .SpeciesStrength {
    text-align: left;
    width: 40px;
  }

  #levelrangeInput {
    width: 70px;
  }

  input[type=text] {
    width: 30px;
    border: 0;
    margin-left: 0;
    background: transparent;
  }

  table {
    table-layout: auto;
  }
</style>

<body>
  <div style="font-size: 0.7em;">
    <h6 style="margin: 0px 10px;">公式：</h6>
    <p style="margin: 0px 10px;">HP：(種*2+個體+努力/4)*Lv/100+Lv+10</p>
    <p style="margin: 0px 10px;">其他：[(種*2+個體+努力/4)*(Lv/100)+5]*性格</p>
    <p style="margin: 0px 10px;">傷害計算：[(2*Lv+10)/250*atk/def*威力+2]*加成</p>
  </div>
  <!-- 計算器table -->
  <table style="width: 100%;">
    <tr>
      <td id="atker">
        <h6 style="text-align: center;">攻擊方</h6>
        <select name="" id="atkerName" style="width:100px"></select>
      </td>

      <td id="defer">
        <h6 style="text-align: center;">防守方</h6>
        <select name="" id="deferName" style="width:100px"></select>
      </td>
    </tr>
  </table>
  <table>
    <tr>
      <th>Level</th>
      <th>
        <input type="range" id="levelrangeInput" min="0" max="100" value="50">
        <input type="button" class="_btn-" value="-" id="level-">
        <input type="number" class="inputnumber" value="50" id="level" style="width: 50px;">
        <input type="button" class="_btn" value="+" id="levelplus">
      </th>
    </tr>
    <tr>
      <th>能力提升</th>
      <th><select name="" id="upplus">
          <option value="0.5" selected>0.5</option>
          <option value="0.66" selected>0.66</option>
          <option value="1" selected>1</option>
          <option value="1.3">1.3</option>
          <option value="1.5">1.5</option>
          <option value="2">2</option>
          <option value="2.5">2.5</option>
          <option value="3">3</option>
          <option value="3.5">3.5</option>
          <option value="4">4</option>
        </select>
      </th>
    </tr>
    <!-- <tr>
      <th>其他結果</th>
      <th><input type="text" class="inputnumber" value="167.6125" id="otherResult"></th>
    </tr> -->
    <tr>
      <th>atk</th>
      <th><input type="range" id="atkrangeInput" min="0" max="1000" value="100">
        <input type="button" class="_btn-" value="-" id="atk-">
        <input type="number" class="inputnumber" value="100" id="atk">
        <input type="button" class="_btn" value="+" id="atkplus"></button>
      </th>
    </tr>
    <tr>
      <th>def</th>
      <th><input type="range" id="defrangeInput" min="0" max="1000" value="100">
        <input type="button" class="_btn-" value="-" id="def-">
        <input type="number" class="inputnumber" value="100" id="def">
        <input type="button" class="_btn" value="+" id="defplus"></button>
      </th>
    </tr>
    <tr>
      <th>威力</th>
      <th><input type="range" id="powerrangeInput" min="0" max="200" value="80">
        <input type="button" class="_btn-" value="-" id="power-">
        <input type="number" class="inputnumber" value="80" id="power">
        <input type="button" class="_btn" value="+" id="powerplus"></button>
      </th>
    </tr>
    <tr>
      <th>本系加成</th>
      <th><select name="" id="selfplus">
          <option value="1" selected>1</option>
          <option value="1.5">1.5</option>
          <option value="2">2</option>
        </select>
      </th>
    </tr>
    <tr>
      <th>屬性相剋</th>
      <th><select name="" id="attrplus">
          <option value="0.25">0.25</option>
          <option value="0.5">0.5</option>
          <option value="1" selected>1</option>
          <option value="2">2</option>
          <option value="4">4</option>
        </select></th>
    </tr>
    <tr>
      <th>天氣加成</th>
      <th><select name="" id="weatherplus">
          <option value="0.5">0.5</option>
          <option value="1" selected>1</option>
          <option value="1.5">1.5</option>
        </select></th>
    </tr>
    <tr>
      <th>道具</th>
      <th>
        <select name="" id="staffplus">
          <option value="1.5">講究系列</option>
          <option value="1" selected>無</option>
          <option value="1.3">生命寶珠</option>
          <option value="1.1">1.1</option>
          <option value="1.2">1.2</option>
        </select>
      </th>
    </tr>
    <tr>
      <th>特性</th>
      <th>
        <select name="" id="characterplus">
          <option value="1" selected>無</option>
          <option value="1.3">強行</option>
        </select>
      </th>
    </tr>
    <tr>
      <th>傷害計算</th>
      <th><input type="number" class="inputnumber" value="37.2" id="damage"></th>
    </tr>
  </table>
</body>
<script>
  var input6 = ["HP", "ATK", "SATK", "DEF", "SDEF", "SPEED"];
  var raceArray = {};
  ["atker", "defer"].forEach(i => {
    var tableString = `
          <table id="${i}Table">
            <tr>
              <td></td>
              <td style="text-align: center;">HP<br><input type="text" readonly value="100" id="${i}HPstrength"></td>
              <td></td>
            </tr>
            <tr>
              <td style="text-align: center;">ATK<br><input type="text" readonly value="100" id="${i}ATKstrength"></td>
              <td rowspan="2" id="${i}drawhexagon">
                <div>
                  <div class="hexagon1"></div>
                  <div class="hexagon2"></div>
                  <div class="hexagon3"></div>
                </div>
              </td>
              <td style="text-align: center;">SATK<br><input type="text" readonly value="100" id="${i}SATKstrength"></td>
            </tr>
            <tr>
              <td style="text-align: center;">DEF<br><input type="text" readonly value="100" id="${i}DEFstrength"></td>
              <td style="text-align: center;">SDEF<br><input type="text" readonly value="100" id="${i}SDEFstrength"></td>
            </tr>
            <tr>
              <td></td>
              <td style="text-align: center;">SPEED<br><input type="text" readonly value="100" id="${i}SPEEDstrength"></td>
              <td></td>
            </tr>
          </table>`;
    $('#' + i).append(tableString);
    var input6string = "";
    input6.forEach(j => {
      input6string +=
        `<tr>
          <td>${j}</td>
          <td>
            <select name="" id="${i}${j}select" style="width: 50px;">
              <option value="31" selected>Best</option>
              <option value="30">Fantastic</option>
              <option value="VeryGood">Very Good</option>
              <option value="PrettyGood">Pretty Good</option>
              <option value="Decent">Decent</option>
              <option value="0">No good</option>
            </select>
          </td>
          <td>
            <input type="range" id="${i}${j}rangeInput" min="0" max="252" value="0" style="width: 80px;">
            <br>
            <input type="button" class="_btn-" value="-" id="${i}${j}-">
            <input type="text" class="inputnumber" value="0" id="${i}${j}Effort">
            <input type="button" class="_btn" value="+" id="${i}${j}plus">
          </td>
        </tr>`
    });
    var inputTotalString =
      `<table style="border: 1px solid black;">
        <!-- 填入 -->
        <tr>
          <td></td>
          <td>個體值</td>
          <td>努力值</td>
        </tr>
        ${input6string}
        <tr>
          <th>性格</th>
          <th class="${i}Nature">
            <select name="" id="${i}selectNature">
              <option value="Adamant">+A-SA</option>
              <option value="Modest">+SA-A</option>
              <option value="Timid">+SP-A</option>
              <option value="Jolly">+SP-SA</option>
              <option value="Lonely">+A-D</option>
              <option value="Naughty">+A-SD</option>
              <option value="Brave">+A-SP</option>
              <option value="Bold">+D-A</option>
              <option value="Impish">+D-SA</option>
              <option value="Lax">+D-SD</option>
              <option value="Relaxed">+D-SP</option>
              <option value="Mild">+SA-D</option>
              <option value="Rash">+SA-SD</option>
              <option value="Quiet">+SA-SP</option>
              <option value="Calm">+SD-A</option>
              <option value="Gentle">+SD-D</option>
              <option value="Careful">+SD-SA</option>
              <option value="Sassy">+SD-SP</option>
              <option value="Hasty">+SP-D</option>
              <option value="Naive">+SP-SD</option>
            </select>
          </th>
        </tr>
      </table>`;
    $('#' + i).append(inputTotalString);
  });
  //6角形
  var hexagon1length = 30;
  var sqrthexagon1length = (Math.sqrt(3) * hexagon1length).toFixed(1);
  $('.hexagon1').css("width", "0");
  $('.hexagon1').css("border-bottom", hexagon1length.toString() + "px solid rgb(185, 185, 185)");
  $('.hexagon1').css("border-left", sqrthexagon1length.toString() + "px solid transparent");
  $('.hexagon1').css("border-right", sqrthexagon1length.toString() + "px solid transparent");
  $('.hexagon2').css("width", (sqrthexagon1length * 2).toString() + "px");
  $('.hexagon2').css("height", (hexagon1length * 2).toString() + "px");
  $('.hexagon2').css("background-color", "rgb(185, 185, 185)");
  $('.hexagon3').css("width", "0");
  $('.hexagon3').css("border-top", hexagon1length.toString() + "px solid rgb(185, 185, 185)");
  $('.hexagon3').css("border-left", sqrthexagon1length.toString() + "px solid transparent");
  $('.hexagon3').css("border-right", sqrthexagon1length.toString() + "px solid transparent");
  var _6species = ["HP", "ATK", "DEF", "SATK", "SDEF", "SPEED"];
  _6species.forEach(element => {
    // var str = `
    // <tbody>
    // </tbody>`;
    // $('#atkerTable').append(str);
  });
  $(document).ready(function () {
    $('#atkerName').select2();
    $('#deferName').select2();
    raceArray["atkerHPrace"] = 45;
    raceArray["atkerATKrace"] = 49;
    raceArray["atkerSATKrace"] = 65;
    raceArray["atkerDEFrace"] = 49;
    raceArray["atkerSDEFrace"] = 65;
    raceArray["atkerSPEEDrace"] = 45;

    raceArray["deferHPrace"] = 45;
    raceArray["deferATKrace"] = 49;
    raceArray["deferSATKrace"] = 65;
    raceArray["deferDEFrace"] = 49;
    raceArray["deferSDEFrace"] = 65;
    raceArray["deferSPEEDrace"] = 45;
    calculateEach("atker");
    calculateEach("defer");
  });
  function switchcalculatorTab(id) {
    var allTable = ["atker", "defer"];
    for (var i in allTable) {
      if (allTable[i] != id) {
        document.getElementById(allTable[i]).style.display = 'none';
        document.getElementsByClassName(allTable[i] + "btn")[0].className = document.getElementsByClassName(allTable[i] + "btn")[0].className.replace(" active", "");
      }
      else {
        if (document.getElementsByClassName(allTable[i] + "btn")[0].className.includes(" active"))
          return;
        document.getElementById(allTable[i]).style.display = 'table-row';
        document.getElementsByClassName(allTable[i] + "btn")[0].className += " active";
      }
    }
  }
  //tab switch
  var natureVal = 1.1;
  function switchNature1Tab(id) {
    var allTable = ["Nature1.1", "Nature1", "Nature0.9"];
    for (var i in allTable) {
      if (allTable[i] != id) {
        document.getElementsByClassName(allTable[i] + "btn")[0].className = document.getElementsByClassName(allTable[i] + "btn")[0].className.replace(" active", "");
      }
      else {
        if (document.getElementsByClassName(allTable[i] + "btn")[0].className.includes(" active"))
          return;
        document.getElementsByClassName(allTable[i] + "btn")[0].className += " active";
        natureVal = parseFloat(id.replace("Nature", ""));
        calculate();
      }
    }
  }
  //+- start
  var totalEffort = 0;
  ["atker", "defer"].forEach(i => {
    input6.forEach(j => {
      ['plus', '-'].forEach(k => {
        $('#' + i + j + k).click(function () {
          var id = "#" + $(this).attr("id").replace(k, '');
          var value = 0;
          if (k == 'plus')
            value = parseInt($(id + 'Effort').val()) + 1;
          else if (k == "-" && parseInt($(id + 'Effort').val()) > 0)
            value = parseInt($(id + 'Effort').val()) - 1;
          else
            value = parseInt($(id + 'Effort').val());
          $(id + 'Effort').val(value);
          $(id + "rangeInput").val(value);
          calculateEach(i);
        });
      });
    });
  });
  ["atker", "defer"].forEach(i => 
  {
    input6.forEach(j => {
      $('#' + i + j + 'rangeInput').on('input', function () {
        var id = "#" + $(this).attr("id").replace('rangeInput', 'Effort');
        $(id).val($(this).val());
        calculateEach(i);
      });
    });
  });
  $('#raceplus,#personalplus,#effortplus,#levelplus,#atkplus,#defplus,#powerplus').click(function () {
    var id = "#" + $(this).attr("id").replace('plus', '');
    var value = parseInt($(id).val()) + 1;
    $(id).val(value);
    $(id + "rangeInput").val(value);
    calculate();
  });
  $('#race-,#personal-,#effort-,#level-,#atk-,#def-,#power-').click(function () {
    var id = "#" + $(this).attr("id").replace('-', '');
    var value = parseInt($(id).val()) - 1;
    $(id).val(value);
    $(id + "rangeInput").val(value);
    calculate();
  });
  //+- end
  //拖拉同步改變text值
  $('#racerangeInput,#personalrangeInput,#effortrangeInput,#levelrangeInput,#atkrangeInput,#defrangeInput,#powerrangeInput').on('input', function () {
    var id = "#" + $(this).attr("id").replace('rangeInput', '');
    $(id).val($(this).val());
  });
  //text值同步改變拖拉長度
  $('#race,#personal,#effort,#level,#atk,#def,#power').on('input', function () {
    var rangeInputName = "#" + $(this).attr("id") + "rangeInput";
    $(rangeInputName).val($(this).val());
  });
  var charactArray;
  function GetCharact(i, j) {
    var charact = 1;
    switch ($('#' + i + 'selectNature').val()) {
      case "Adamant":
        if (j == "ATK") charact = 1.1;
        if (j == "SATK") charact = 0.9; break;
      case "Modest":
        if (j == "SATK") charact = 1.1;
        if (j == "ATK") charact = 0.9; break;
      case "Timid":
        if (j == "SPEED") charact = 1.1;
        if (j == "ATK") charact = 0.9; break;
      case "Jolly":
        if (j == "SPEED") charact = 1.1;
        if (j == "SATK") charact = 0.9; break;
      case "Lonely":
        if (j == "ATK") charact = 1.1;
        if (j == "DEF") charact = 0.9; break;
      case "Naughty":
        if (j == "ATK") charact = 1.1;
        if (j == "SDEF") charact = 0.9; break;
      case "Brave":
        if (j == "ATK") charact = 1.1;
        if (j == "SPEED") charact = 0.9; break;
      case "Bold":
        if (j == "DEF") charact = 1.1;
        if (j == "ATK") charact = 0.9; break;
      case "Impish":
        if (j == "DEF") charact = 1.1;
        if (j == "SATK") charact = 0.9; break;
      case "Lax":
        if (j == "DEF") charact = 1.1;
        if (j == "SDEF") charact = 0.9; break;
      case "Relaxed":
        if (j == "DEF") charact = 1.1;
        if (j == "SPEED") charact = 0.9; break;
      case "Mild":
        if (j == "SATK") charact = 1.1;
        if (j == "DEF") charact = 0.9; break;
      case "Rash":
        if (j == "SATK") charact = 1.1;
        if (j == "SDEF") charact = 0.9; break;
      case "Quiet":
        if (j == "SATK") charact = 1.1;
        if (j == "SPEED") charact = 0.9; break;
      case "Calm":
        if (j == "SDEF") charact = 1.1;
        if (j == "ATK") charact = 0.9; break;
      case "Gentle":
        if (j == "SDEF") charact = 1.1;
        if (j == "DEF") charact = 0.9; break;
      case "Careful":
        if (j == "SDEF") charact = 1.1;
        if (j == "SATK") charact = 0.9; break;
      case "Sassy":
        if (j == "SDEF") charact = 1.1;
        if (j == "SPEED") charact = 0.9; break;
      case "Hasty":
        if (j == "SPEED") charact = 1.1;
        if (j == "DEF") charact = 0.9; break;
      case "Naive":
        if (j == "SPEED") charact = 1.1;
        if (j == "SDEF") charact = 0.9; break;
    }
    //console.log(i + " " + j + " " + charact);
    return charact;
  }
  var calculateEach = function (i) {//i=atker,defer
    console.log(raceArray);
    input6.forEach(j => {//j=6 
      var race = parseInt(raceArray[i + j + 'race']);
      var personal = parseInt($('#' + i + j + 'select').val());
      var effort = parseInt($('#' + i + j + 'Effort').val());
      var level = 50;
      var charact = GetCharact(i, j);
      var upplus = 1;
      var hpResult = ((race * 2 + personal + effort / 4) * (level / 100)) + level + 10;
      var result = ((race * 2 + personal + effort / 4) * (level / 100) + 5) * charact * upplus;
      if (j == 'HP')
        $('#' + i + 'HPstrength').val(parseInt(hpResult));
      else
        $('#' + i + j + 'strength').val(parseInt(result));
    });
  }
  var calculate = function () {
    var race = parseInt($('#race').val());
    var personal = parseInt($('#personal').val());
    var effort = parseInt($('#effort').val());
    var level = parseInt($('#level').val());
    var charact = natureVal;
    var res = (race * 2 + personal + effort / 4) * (level / 100) + level + 10;
    var upplus = parseFloat($('#upplus').val());
    var otherres = ((race * 2 + personal + effort / 4) * (level / 100) + 5) * charact * upplus;
    $('#Result').val(res.toString());
    $('#otherResult').val(otherres.toString());
    var atk = parseInt($('#atk').val());
    var def = parseInt($('#def').val());
    var power = parseInt($('#power').val());
    var selfplus = parseFloat($('#selfplus').val());
    var attrplus = parseFloat($('#attrplus').val());
    var weatherplus = parseFloat($('#weatherplus').val());
    var staffplus = parseFloat($('#staffplus').val());
    var characterplus = parseFloat($('#characterplus').val());
    var calculatedamage = ((2 * level + 10) / 250 * atk / def * power + 2) * selfplus * attrplus * weatherplus * staffplus * characterplus;
    $('#damage').val(calculatedamage.toString());
  }
  //改變值立刻計算結果
  $('#race,#personal,#effort,#level,#racerangeInput,#personalrangeInput,#effortrangeInput,#levelrangeInput,#atkrangeInput,#defrangeInput,#powerrangeInput,#atk,#def,#power').on('input', calculate);
  $('#upplus,#selfplus,#attrplus,#weatherplus,#staffplus,#characterplus').on('change', calculate);
</script>

</html>