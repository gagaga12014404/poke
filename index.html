<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.2/css/bootstrap.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/1.11.3/css/dataTables.bootstrap4.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.2.9/css/responsive.bootstrap4.min.css">
  <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
  <script src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script>
  <!-- <script src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.min.js"></script> -->
  <script src="https://cdn.datatables.net/1.11.3/js/dataTables.bootstrap4.min.js"></script>
  <script src="https://cdn.datatables.net/responsive/2.2.9/js/dataTables.responsive.min.js"></script>
  <script src="https://cdn.datatables.net/responsive/2.2.9/js/responsive.bootstrap4.min.js"></script>

  <style>
    table {
      table-layout: fixed;
    }

    .inputSearch {
      font-size: 0.7em;
      width: 100%;
      height: 25px;
    }

    th {
      font-size: 0.7em;
    }

    td {
      font-size: 0.7em;
    }

    .th0 {
      width: 25px;
    }

    .th1 {
      width: 50px;
    }

    .th2 {
      height: 10px;
      width: 90px;
    }

    .thhp {
      width: 25px;
    }
  </style>
</head>

<body>


  <table id="all" class="table table-striped table-bordered dt-responsive nowrap" width="95%">
    <thead>
      <tr id="theadtr">
        <th rowspan="2" class="th0">編號</th>
        <th rowspan="2" class="th1">名稱</th>
        <th colspan="2" style="width: 90px;text-align: center;height: 10px;padding: 0;">屬性</th>
        <th rowspan="2" class="thhp" id="copy">
          <select id="selectAbility" multiple size="1" style="padding: 0; width: auto;z-index:-100;">
            <option value="hp">生命</option>
            <option value="atk">物攻</option>
            <option value="def">物防</option>
            <option value="satk">特攻</option>
            <option value="sdef">特防</option>
            <option value="speed">速度</option>
            <option value="fiveTotal">能力值</option>
          </select>
        </th>
        <th rowspan="2" class="thhp">生命</th>
        <th rowspan="2" class="thhp">物攻</th>
        <th rowspan="2" class="thhp">物防</th>
        <th rowspan="2" class="thhp">特攻</th>
        <th rowspan="2" class="thhp">特防</th>
        <th rowspan="2" class="thhp">速度</th>
        <th rowspan="2" class="thhp">能力值</th>
      </tr>
      <tr>
        <th style="padding: 0;height: 10px;width: 45px;text-align: center;">1</th>
        <th style="padding: 0;height: 10px;width: 45px;text-align: center;">2</th>
      </tr>
    </thead>
    <tfoot>
      <tr style="height: 25px;">
        <th id="nu" style="padding: 0;width: 35px;">編號</th>
        <th id="na" style="padding: 0;width: 50px;">名稱</th>
        <th colspan="2" style="padding: 0;width: 45px;text-align: center;"></th>
        <!-- <th style="padding: 0;height: 10px;width: 45px;text-align: center;">2</th> -->
        <th class="thhp"></th>
        <th class="thhp"></th>
        <th class="thhp"></th>
        <th class="thhp"></th>
        <th class="thhp"></th>
        <th class="thhp"></th>
        <th class="thhp"></th>
        <th></th>
      </tr>
    </tfoot>
  </table>
</body>
<script>
  var GetFiveTotal = function (data) {
    var inthp = parseInt(data["hp"]);
    var intatk = parseInt(data["atk"]);
    var intdef = parseInt(data["def"]);
    var intsatk = parseInt(data["satk"]);
    var intsdef = parseInt(data["sdef"]);
    var intspeed = parseInt(data["speed"]);
    return inthp + intatk + intdef + intsatk + intsdef + intspeed;
  }
  var column = ["編號", "名稱", "屬性", "生命", "物攻", "物防", "特攻", "特防", "速度"]
  var columns = [
    { "data": "number" },
    { "data": "cName" },
    { "data": "attr1" },
    { "data": "attr2" },
    { "data": "hp" },
    { "data": "hp" },
    { "data": "atk" },
    { "data": "def" },
    { "data": "satk" },
    { "data": "sdef" },
    { "data": "speed" },
    { "data": null, render: GetFiveTotal },
  ];


  $('#nu,#na').each(function () {
    var title = $(this).text();
    $(this).html('<input type="text" class="inputSearch" placeholder="' + title + '" />');
  });
  $(document).ready(function () {
    var table = $('#all').DataTable({
      "ajax": "data.json",
      //拿到ajax的結果
      // "drawCallback": function (settings) {
      //   // Here the response
      //   response = settings.json;

      // },
      "columns": columns,
      "dom": 'rtip',
      // "info":     false,
      "pagingType": "numbers",
      initComplete: function () {
        // Apply the search
        //指定欄位搜尋
        this.api()
          .columns([0, 1])//用column指定
          .every(function () {
            var that = this
            $('input', this.footer()).on('keyup change clear', function () {
              if (that.search() !== this.value) {
                that.search(this.value).draw();
              }
            });
          });
        //指定欄位下拉選單
        this.api()
          .columns([2, 3])
          .every(function () {
            var column = this;
            var select = $('<select style=" height: 25px; " ><option value=""></option></select>')
              .appendTo($(column.footer()).empty())
              .on('change', function () {
                var val = $.fn.dataTable.util.escapeRegex($(this).val());
                column.search(val ? '^' + val + '$' : '', true, false).draw();
              });

            column
              .data()
              .unique()
              .sort()
              .each(function (d, j) {
                if (typeof (d) == 'string')
                  select.append('<option value="' + d + '">' + d + '</option>');
              });
          });
      },
      "columnDefs": [
        { targets: [0], responsivePriority: 1 },
        { targets: [1], responsivePriority: 2 },
        { targets: [2], responsivePriority: 3 },
        { targets: [3], responsivePriority: 3 },
        { targets: [4], responsivePriority: 4 },
        { targets: [5], responsivePriority: 4 },
        { targets: [6], responsivePriority: 4 },
        { targets: [7], responsivePriority: 4 },
        { targets: [8], responsivePriority: 4 },
        { targets: [9], responsivePriority: 4 },
      ],
    });
    //動態新增刪除欄位
    $('button.toggle-vis').on('click', function (e) {
      e.preventDefault();

      // Get the column API object
      var column = table.column($(this).attr('data-column'));

      // Toggle the visibility
      column.visible(!column.visible());
    });

    document.getElementById('selectAbility').addEventListener('touchend', function (e) {
      var dg = document.getElementById('selectAbility');
      var each = dg.scrollHeight / 7;//每個欄位的長度
      dg.selectedIndex = Math.round(this.scrollTop / each) ;//四捨五入目前未選到第幾個
    });
  });
</script>

</html>